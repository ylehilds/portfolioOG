<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="../styles/styles.css">
<link rel="stylesheet" href="../css/pro-portfolio.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<meta charset="UTF-8" />
<meta name="description" content="Lehi Alcantara IT 515R IoT Systems Engineering Web tutorials">
<meta name="keywords" content="Lehi Alcantara, HTML, CSS, JavaScript, IoT, Systems Engineering, Web tutorials, Arduino, Raspberry Pi, Smart Home, Slack, Python, DHT11, DHT22, Reed Switch, Ultra Sonic Sensor, HC-SR04, temperature, humidity ">
<meta name="author" content="Lehi Alcantara">
<title>Lab 2 &#8211; IT 515R &#8211; IoT Systems Engineering</title>
</head>
<body>
<article>
	<header>
		<h1>Lab 2</h1>			</header><!-- .entry-header -->
	<div>
		<p><span style="font-weight: 400;">Wifi-Controlled LED Stoplight (Arduino)</span></p>
<h1><span style="font-weight: 400;">Online Link</span></h1>
<p><span style="font-weight: 400;">This lab is available as part of my online portfolio at: </span><a href="https://www.lehi.dev"><span style="font-weight: 400;">https://www.lehi.dev</span></a></p>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Objective</span></h1>
<p><span style="font-weight: 400;">The purpose of this lab is learn how to create a wifi-controlled stoplight using Arduino. These principles include:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Install and become familiar with Arduino IDE in order to use in conjunction with Wemos D1 Mini microcontrollers.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Enumerate requirements from use case and user stories.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Develop a minimum viable product and refactor it to account for new requirements.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Learn and use Github private repository and share it with a specific contributor.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Become familiar with representing the desired system by using flowcharts, state diagrams, etc.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Compile and upload program code to from Arduino IDe tro the Wemos D1 mini.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Learn to plan what materials will be necessary to accomplish the system’s purpose</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Become familiar with coding in the Arduino (modified C language).</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Become familiar and learn how to use Arduino-based microcontroller to use GPIO pins. to control LEDs. </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Learn to run a server using sketches to connect D1 mini to wifi. Build a server that accepts rest protocol to change Arduino GPIO stoplight state and LEDs.</span></li>
</ul>
<h1><span style="font-weight: 400;">Materials</span></h1>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Personal Computer</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x Wemos D1 Mini microcontrollers (ESP8266)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">2.5A USB Power Supply with micro USB Cable</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x breadboard</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x Red LED</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x Yellow LED</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x Green LED</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">3 x 220 Ω Resistor (</span><span style="font-weight: 400;">RR</span><span style="font-weight: 400;">BlBl</span><span style="font-weight: 400;">Br</span><span style="font-weight: 400;">) </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Arduino IDE</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Fritzing</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Jump wires</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Soldering iron</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Solder</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">GPIO pinout guide</span></li>
</ul>
<h1><span style="font-weight: 400;">References</span></h1>
<p><span style="font-weight: 400;">The following resources were used in this lab:</span></p>
<ul>
<li style="font-weight: 400;"><a href="https://www.youtube.com/watch?v=G6CqvhXpBKM"><span style="font-weight: 400;">https://www.youtube.com/watch?v=G6CqvhXpBKM</span></a><span style="font-weight: 400;"> &#8211; Great tutorial on how to use Arduino IDE with Wemos D1 mini (ESP8266).</span></li>
<li style="font-weight: 400;"><a href="https://app.pluralsight.com/library/courses/arduino-introduction/table-of-contents"><span style="font-weight: 400;">https://app.pluralsight.com/library/courses/arduino-introduction/table-of-contents</span></a><span style="font-weight: 400;"> &#8211; Pluralsight course on how to get started with Arduino.</span></li>
<li style="font-weight: 400;"><a href="https://learningsuite.byu.edu/plugins/Upload/fileDownload.php?fileId=70f7d913-ioSF-xMVW-I06U-m67a1cc00e96"><span style="font-weight: 400;">https://learningsuite.byu.edu/plugins/Upload/fileDownload.php?fileId=70f7d913-ioSF-xMVW-I06U-m67a1cc00e96</span></a><span style="font-weight: 400;"> &#8211; Lab write up example.</span></li>
<li style="font-weight: 400;"><a href="https://github.com/todddb/example-lab/blob/master/example-lab/example-lab.ino"><span style="font-weight: 400;">https://github.com/todddb/example-lab/blob/master/example-lab/example-lab.ino</span></a><span style="font-weight: 400;"> &#8211; Greate example on how to get started with Arduino and get a server up and running.</span></li>
<li style="font-weight: 400;"><a href="http://www.esp8266learning.com/wemos-webserver-example.php"><span style="font-weight: 400;">http://www.esp8266learning.com/wemos-webserver-example.php</span></a><span style="font-weight: 400;"> &#8211; great arduino webserver example. </span></li>
<li style="font-weight: 400;"><a href="http://www.instructables.com/id/Programming-the-WeMos-Using-Arduino-SoftwareIDE/"><span style="font-weight: 400;">http://www.instructables.com/id/Programming-the-WeMos-Using-Arduino-SoftwareIDE/</span></a><span style="font-weight: 400;">  &#8211; programming wemos D1 mini</span></li>
<li style="font-weight: 400;"><a href="https://www.w3schools.com/howto/howto_css_switch.asp"><span style="font-weight: 400;">https://www.w3schools.com/howto/howto_css_switch.asp</span></a><span style="font-weight: 400;"> &#8211; </span></li>
<li style="font-weight: 400;"><a href="https://www.arduino.cc/en/Main/Software"><span style="font-weight: 400;">https://www.arduino.cc/en/Main/Software</span></a><span style="font-weight: 400;"> &#8211; Arduino IDE software download</span></li>
<li style="font-weight: 400;"><a href="http://fritzing.org/download/"><span style="font-weight: 400;">http://fritzing.org/download/</span></a><span style="font-weight: 400;"> &#8211; Fritzing is a great tool to visualize electronics prototype.</span></li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Procedures</span></h1>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Solder the pin attachments through the Wemos D1 mini in order to utilize the breadboard and jump wires and LEDs</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Download and install Arduino IDE from </span><a href="https://www.arduino.cc/en/Main/Software"><span style="font-weight: 400;">https://www.arduino.cc/en/Main/Software</span></a></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Install CH341 version 1.4 from the following website: </span><a href="https://kig.re/2014/12/31/how-to-use-arduino-nano-mini-pro-with-CH340G-on-mac-osx-yosemite.html"><span style="font-weight: 400;">https://kig.re/2014/12/31/how-to-use-arduino-nano-mini-pro-with-CH340G-on-mac-osx-yosemite.html</span></a></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Add Wemos D1 library to the Arduino IDE:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Arduino &gt; Preferences &gt; (in addition Boards Manager URLs paste the following: </span><a href="https://kig.re/2014/12/31/how-to-use-arduino-nano-mini-pro-with-CH340G-on-mac-osx-yosemite.html"><span style="font-weight: 400;">https://kig.re/2014/12/31/how-to-use-arduino-nano-mini-pro-with-CH340G-on-mac-osx-yosemite.html</span></a><span style="font-weight: 400;">)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Tools &gt; Board &gt; Boards Manager &gt; (search for “esp8266”) then click install.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Tools &gt; Board &gt; “LOLIN(WEMOS) D1 R2 &amp; mini”</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Then selected the connected arduino by going to:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Tools &gt; Port &gt; /dev/cu.wchusbserial14510 </span></li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Used the Arduino IDE to develop the code for the stoplight.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Used the Arduino GPIO pinout to decide which pins to use for this project from </span><a href="https://pinout.xyz/"><span style="font-weight: 400;">https://pinout.xyz/</span></a><span style="font-weight: 400;">.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">In version 1 I wanted to design a system that all it would do was to turn on the lights according to the pins that were on.</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">I Chose the following pins to be on:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Pin D6: Green color</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Pin D8: Yellow color</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Pin D1: Red color</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Pin G: Ground</span></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><a href="./images/lab2ArduinoBreadboardPicture.jpeg"><img loading="lazy" class="alignnone size-full wp-image-36" src="./images/lab2ArduinoBreadboardPicture.jpeg" alt="" width="2448" height="3264" /></a></p>
<ol>
<li style="list-style-type: none;">
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">I had one Ground pin from GPIO to breadboard negative column, then connected 220 Ω resistors to LEDs negative end point.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">In version 2, once I got the green LED to come on using GPIO commands then I started replicating the same process to the other LEDs both server side methods as well as front-end sliders. All server endpoints changed LED state, turned on LED and loaded the page with LED state as querystring.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">For the case of blinking LEDs until another command would stop it: I programmed a javascript fetch request to the server, coded an end point to handle it. The algorithm was essentially the following:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Get lightsRelay state.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If still “on” then proceed cycling through the LEDs.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Then repeat step 3.1 above again recursively style not a loop.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If “off” then proceed change lightsRelay state which in turn will break the cycle.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Models:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Functionality: State machine as shown on the diagram below, this is a simplified form of the state machine as in reality I have created many endpoints to change the state machine for each led, but the basic concept is described below for each endpoint it reacts as the following diagram:</span></li>
</ol>
</li>
</ol>
<p><a href="./images/lab2StateMachineDiagram.jpeg"><img loading="lazy" class="alignnone size-full wp-image-23" src="./images/lab2StateMachineDiagram.jpeg" alt="" width="701" height="394" /></a></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">On Start up, the machine will be on LED Off state</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Case “LED OFF”</span>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">If system receives /ledOn then system changes to “LED ON” state.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If system receives /ledOff then system remain in “LED OFF” state.</span></li>
</ul>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Case “LED ON”</span>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">If system receives /ledOn then system remains in “LED ON” state.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If system receives /ledOff then system changes to “LED OFF” state.</span></li>
</ul>
</li>
</ul>
<ol>
<li style="list-style-type: none;">
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">System Flow: See Appendix 1.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Component and Schematic Diagram: The stoplight system is represented below by the following diagrams (Component and Schematic Diagram respectively)</span></li>
</ol>
</li>
</ol>
<p><a href="./images/lab2ComponentDiagram.png"><img loading="lazy" class="alignnone size-full wp-image-35" src="./images/lab2ComponentDiagram.png" alt="" width="596" height="380" /></a></p>
<p>&nbsp;</p>
<p><a href="./images/lab2SchematicDiagram.png"><img loading="lazy" class="alignnone size-full wp-image-38" src="./images/lab2SchematicDiagram.png" alt="" width="716" height="448" /></a></p>
<p><span style="font-weight: 400;">Diagrams were facilitated by open source programs such as: Google drive plugin draw.io Diagrams and Fritzing.</span></p>
<p>&nbsp;</p>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Program the code in the Arduino IDE </span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Code the Arduino GPIO pins interaction with breadboard, resistors, LEDs accordingly to match the previous component/schematic diagram.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Test/Debug constantly so the final product would be bug free. You can debug by first making sure the baud rate is set up in setup method. Then click on serial monitor icon <a href="./images/lab2SerialMonitorIcon.png"><img loading="lazy" class="smallIcon" src="./images/lab2SerialMonitorIcon.png" alt="" width="48" height="50" /></a> </span><span style="font-weight: 400;">, which then after compiling and uploading the code to the Wemos D1 mini you should see something similar to below screenshot:</span></li>
</ol>
</li>
</ol>
<p><a href="./images/lab2SerialMonitorOutput.png"><img loading="lazy" class="alignnone size-full wp-image-40" src="./images/lab2SerialMonitorOutput.png" alt="" width="1688" height="736" /></a></p>
<ol>
<li style="list-style-type: none;">
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use commands such as Serial.println(&lt;variableToBeEvaluated&gt;) to print out debug messages, so you can make sure what you think the code is doing is actually happening.</span></li>
</ol>
</li>
</ol>
<h1><span style="font-weight: 400;">Thought Questions</span></h1>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">What are some key differences between developing this lab on a Raspberry Pi, and developing on Arduino?</span><span style="font-weight: 400;"> Using python on a raspberry pi allowed me to leverage my current knowledge and libraries I knew could do certain things simpler. While working on the arduino I noticed some limitations on the Arduino language, modified C, that I was less familiar with it and responding back from server requests was more difficult with Arduino, since I had to print every line back to client.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">What are the strengths and trade-offs of each of these platforms? </span><span style="font-weight: 400;">Raspberry pi Strengths: Easier programming language (Python), easier libraries to use (Flask), better debugging tools. The trade-off is that it requires more computing resources to run python and its libraries. Arduino Strengths: from what I could tell it makes it programming a lot simpler than plain C, where I don’t need to compile and make file and upload program to the microcontroller, it makes that deployment task a lot simpler, one click of a button does all that for me. The language looks a bit more like Java and .Net it allows you to code in simpler data structures, then before deployment it process it and transform certain data structures to C level. It requires less resource compared to raspberry pi. The trade-off is that the learning curve is higher than raspberry pi and libraries to use may be less well known.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">How familiar were you with the Arduino platform prior to this lab? </span><span style="font-weight: 400;">I had no previous experience. </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">What was the biggest challenge you overcame in this lab? </span><span style="font-weight: 400;">Because I didn’t know anything about the Arduino that obviously played a role in difficulty, so I had to read a few tutorials and videos on how to use it, debug, etc. The LEDs cycle was also difficult due to that I didn’t know how to easily have a different thread to run a certain task. So I had to think outside the box a bit to come up with a solution that would work for the requirements.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Please estimate the total time you spent on this lab and report. </span>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 hour building and refactoring the circuit</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">8 hours coding the server and fixing bugs and getting acquainted with GPIO coding and setting up a Restful server using Flask Python library</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">3 hours working on the lab report using tools such as Google draw.io Diagrams  and fritzing.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">2 hours publishing a website with lab 1 instructions, mainly dealing with formats.</span></li>
</ul>
</li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Certification of Work</span></h1>
<p><span style="font-weight: 400;">I certify that the solution presented in this lab represents my own work. In the case where I have borrowed code or ideas from another person, I have provided a link to the author’s work in the references, and included a citation in the comments of my code.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">&#8212; Lehi Alcantara</span></p>
<h1><span style="font-weight: 400;">Appendix</span></h1>
<h2><span style="font-weight: 400;">Appendix 1: System Flowchart</span></h2>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="./images/lab2SystemFlowchart.jpeg"><img loading="lazy" class="alignnone size-full wp-image-39" src="./images/lab2SystemFlowchart.jpeg" alt="" width="391" height="1131" /></a></p>
<h2><span style="font-weight: 400;">Appendix 2: System Interface &#8211; Web Page</span></h2>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">State: startup</span></p>
<p><a href="./images/lab2StartupState.png"><img loading="lazy" class="alignnone wp-image-45" src="./images/lab2StartupState.png" alt="" width="385" height="441" /></a></p>
<p><span style="font-weight: 400;">State: greenLed=on</span></p>
<p>&nbsp;</p>
<p><a href="./images/lab2GreenLedOnState.png"><img loading="lazy" class="alignnone size-full wp-image-44" src="./images/lab2GreenLedOnState.png" alt="" width="1006" height="1000" /></a></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">State: greenLed=off</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="./images/lab2GreenLedOffState.png"><img loading="lazy" class="alignnone size-full wp-image-43" src="./images/lab2GreenLedOffState.png" alt="" width="934" height="1002" /></a></p>
<h2><span style="font-weight: 400;">Appendix 3: Server Monitor Output</span></h2>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="./images/lab2ServerMonitorOutput.png"><img loading="lazy" class="alignnone size-full wp-image-42" src="./images/lab2ServerMonitorOutput.png" alt="" width="1686" height="726" /></a></p>
<h2><span style="font-weight: 400;">Appendix 4: Arduino Code</span></h2>
<p><span style="font-weight: 400;">(Available at </span><a href="https://github.com/ylehilds/arduinoStoplight"><span style="font-weight: 400;">https://github.com/ylehilds/arduinoStoplight</span></a><span style="font-weight: 400;">)</span></p>
<p>&nbsp;</p>
	</div><!-- .entry-content -->
</article>
</body>
</html>
