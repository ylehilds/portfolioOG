<!DOCTYPE html>
<html lang="en">
<head>
<link rel="stylesheet" href="../styles/styles.css">
<link rel="stylesheet" href="../css/pro-portfolio.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<meta charset="UTF-8">
<meta name="description" content="Lehi Alcantara IT 515R IoT Systems Engineering Web tutorials">
<meta name="keywords" content="Lehi Alcantara, HTML, CSS, JavaScript, IoT, Systems Engineering, Web tutorials, Arduino, Raspberry Pi, Smart Home, Slack, Python, DHT11, DHT22, Reed Switch, Ultra Sonic Sensor, HC-SR04, temperature, humidity ">
<meta name="author" content="Lehi Alcantara">
<title>Project &#8211; IT 515R &#8211; IoT Systems Engineering</title>
</head>
<body>
<article>
	<header><h1>Project</h1></header>
	<div>
		<p><span style="font-weight: 400;">IoT Project &#8211; Temperature Sensors</span></p>
<h1><span style="font-weight: 400;">Online Link</span></h1>
<p><span style="font-weight: 400;">This project is available as part of my online portfolio at: </span><a href="https://www.lehi.dev"><span style="font-weight: 400;">https://www.lehi.dev</span></a></p>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Problem/Issue &amp; Proposed Solution</span></h1>
<p><span style="font-weight: 400;">Many times in my house I have a perfect/desired temperature on the main floor which happens to have the thermostat controller, but on a specified room It is always warmer beyond comfortable level. For the solution for this problem I have designed a system where I monitor each level: basement, main, upstairs. Create a website graph to see high level where each level temperature is at as well as created a slack bit and channel to let me know each level temperature as well as send commands to turn the fan on or off. Every hour it sends data for all 3 levels. If the upstairs passes a threshold then turn on the fan if it gets below a threshold then turn off the fan.The purpose of this project is to learn how to use IoT devices to solve a problem. Establish complex conditions by using sensors, these principles include:</span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Implement Restful API to facilitate data transfer from sensors</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Implement MQTT system to make all sensors synchronized and pass and receive data amongst each other.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Develop a full feature UI interface displaying temperature data states from sensors for a specific time frame.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Implement a non web page interface to gather each level temperature</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use slackbot to act on certain conditions.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Leverage AWS cloud to assist on keeping track of each level temperature using DynamoDB for later queries and IoT core to act on certain data being received including sending text message and send commands to a slackbot.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Learn to plan what materials will be necessary to accomplish the system’s purpose</span></li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Materials</span></h1>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Personal Computer</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">4 x Wemos D1 Mini microcontrollers (ESP8266)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">3 x DHT22/DHT11 shields to connect on top of ESP8266</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">3 x 2.5A USB Power Supply with micro USB Cable</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x raspberry pi with SD micro sd card and charger</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x fan</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 x Wemo Mini Smart Plug, WiFi Enabled (or any smart plug that exposes their API via http)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Arduino IDE</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Fritzing</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Soldering iron</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Solder</span></li>
</ul>
<h1><span style="font-weight: 400;">References</span></h1>
<p><span style="font-weight: 400;">The following resources were used in this project:</span></p>
<ul>
<li style="font-weight: 400;"><a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-sdk-setup.html"><span style="font-weight: 400;">https://docs.aws.amazon.com/iot/latest/developerguide/iot-sdk-setup.html</span></a><span style="font-weight: 400;"> &#8211; Great tutorial that teaches how to creat thing using raspberry pi.</span></li>
<li style="font-weight: 400;"><a href="https://realpython.com/python-exceptions/"><span style="font-weight: 400;">https://realpython.com/python-exceptions/</span></a><span style="font-weight: 400;"> &#8211; good tutorial teaching python exceptions</span></li>
<li style="font-weight: 400;"><a href="https://aws.amazon.com/getting-started/projects/build-serverless-web-app-lambda-apigateway-s3-dynamodb-cognito/module-1/"><span style="font-weight: 400;">https://aws.amazon.com/getting-started/projects/build-serverless-web-app-lambda-apigateway-s3-dynamodb-cognito/module-1/</span></a><span style="font-weight: 400;"> &#8211; Great tutorial teaching how to create a serverless web application</span></li>
<li style="font-weight: 400;"><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.ReadData.Query.html"><span style="font-weight: 400;">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.ReadData.Query.html</span></a><span style="font-weight: 400;"> &#8211; Great tutorial teaching how to query DynamoDB table</span></li>
<li style="font-weight: 400;"><a href="https://www.highcharts.com/demo/line-ajax"><span style="font-weight: 400;">https://www.highcharts.com/demo/line-ajax</span></a><span style="font-weight: 400;"> &#8211; Great highcharts demo</span></li>
<li style="font-weight: 400;"><a href="https://blog.benjie.me/building-a-slack-bot-to-talk-with-a-raspberry-pi/"><span style="font-weight: 400;">https://blog.benjie.me/building-a-slack-bot-to-talk-with-a-raspberry-pi/</span></a><span style="font-weight: 400;"> &#8211; Great resource on how to get a slack python bot running locally on a raspberry pi.</span></li>
<li style="font-weight: 400;"><a href="https://www.geeksforgeeks.org/get-post-requests-using-python/"><span style="font-weight: 400;">https://www.geeksforgeeks.org/get-post-requests-using-python/</span></a><span style="font-weight: 400;"> &#8211; Greate resource on how to use requests python library to make Rest calls.</span></li>
<li style="font-weight: 400;"><a href="https://www.esp8266.com/viewtopic.php?t=2153"><span style="font-weight: 400;">https://www.esp8266.com/viewtopic.php?t=2153</span></a><span style="font-weight: 400;"> &#8211; Simple rest api example.</span></li>
<li style="font-weight: 400;"><a href="https://mancusoa74.blogspot.com/2018/02/simple-http-rest-server-on-esp8266.html"><span style="font-weight: 400;">https://mancusoa74.blogspot.com/2018/02/simple-http-rest-server-on-esp8266.html</span></a><span style="font-weight: 400;"> &#8211; Great tutorial on web erver Rest Api.</span></li>
<li style="font-weight: 400;"><a href="https://learningsuite.byu.edu"><span style="font-weight: 400;">https://learningsuite.byu.edu</span></a><span style="font-weight: 400;"> &#8211; IoT Project requirements.</span></li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Requirements</span></h1>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">Utilize at least 3 physical devices (one sensor and two actuators, or two sensors and one actuator) </span><span style="font-weight: 400;">&#8211; Used 5 (4 ESP8266 along with 2 DHT22 and 1 DHT11, 1 raspberry pi)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Utilize at least 2 wireless communication protocols (wifi, BLE, RFID, LoRa, etc) </span><span style="font-weight: 400;">&#8211; Used Wifi and MQTT</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Utilize restful API </span><span style="font-weight: 400;">&#8211; Checked</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Utilize event hub or cloud IoT service </span><span style="font-weight: 400;">&#8211; Used several AWS services (AWS IoT Core, DynamoDB, SNS, Lambda, API Gateway, S3)</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Utilize a non-web page interface (voice, IFTTT, chat) </span><span style="font-weight: 400;">&#8211; Used Slackbot on a Slack channel</span></li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Procedures</span></h1>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Solder 4 ESP8266 to act as IoT computing WiFi devices and MQTT send and receive data from topics. </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Solder 3 DHT22/DHT11 to gather each level temperature. You could use a combination of them or just all the same.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Develop code to gather temperature information for each level, subscribe to topics to receive commands and publish to topics to send data out from the sensors.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Program the code in the Arduino IDE </span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Test/Debug to make sure the logic is sound. You can debug by first making sure the baud rate is set up in setup method. Then click on serial monitor icon <a href="./images/projectSerialMonitorIcon.png"><img loading="lazy" class="smallIcon" src="./images/projectSerialMonitorIcon.png" alt="" width="48" height="50" /></a> </span><span style="font-weight: 400;">. </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use commands such as Serial.println(&lt;variableToBeEvaluated&gt;) to print out debug messages, so you can make sure what you think the code is doing is actually happening.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use 1 ESP8266 to act as a restful api, listen to a specific endpoints and publish to a topics to gather the desired data information.</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">How to:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use the ESP8266WebServer library as to serve endpoints that will be exposed for clients to hit it.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create different endpoints for each sensor in order to expose the data extraction from the sensor.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use ArduinoJson library to work with json responses from each sensor as to return the response to the clients.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use ESP8266WiFi to connect to wifi. PubSubClient library to connect to mosquitto message broker. Add your secrets and keys to a file and put it into .gitignore so that is not sent to github and expose passwords to the world.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">On each endpoint publish to a topic that the sensor is listening to and then subscribe for their responses in order to get their responses.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Once data is collected back from sensors then send it back to the client requestor in json format.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Send data to AWS IoT Core</span></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>&nbsp;</p>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use a raspberry pi and install Mosquitto (Message broker application) to act as a message broker, sending and receiving messages to any device subscribed to a given topic.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create MQTT topics and subscribe the Temperature ESP8266 to be listening and publish to certain topics.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use/Get AWS account</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setup a raspberry pi to be a ”thing” in IoT Core services, create AWS certificates, download them to raspberry pi so it can communicate with AWS IoT Core services.</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">How to:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">IoT Core &gt; Manage &gt; Create &gt; Create  a single thing &gt; follow prompts</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create certificates &gt; activate &gt; download all certificates including root CA for AWS IoT</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Secure &gt; policies &gt; Create &gt; Add policy to be able to interact with IoT</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Attach a policy to the thing</span></li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create a cron job that runs a python script at every hour and makes http requests for all 3 levels ESP8266 and send the temperature readings to AWS IoT Core services.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setup an “Act” under AWS IoT Core services action that listens for a specific level for example “upstairs” and a specific temperature like “temperature &gt; 70 or temperature &lt; 70” then add a trigger that sends a text message or call a lambda function, etc. You could add quite a few triggers from a message received from raspberry pi, use one that makes sense for you. The ones I decided to implement were:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">SNS messaging:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">On AWS account setup a SNS service to text message you when the service is triggered.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Lambda:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">On AWS account setup a lambda that once triggered makes an http request POST call to a slackbot. The event that goes to the AWS lambda function would contain the level and the temperature. Then the lambda decides whether to turn the fan on if the temperature is more than 70 degrees or to turn the fan off if the temperature is less than 70 degrees.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">How to:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">IoT Core &gt; Act &gt; Create &gt; fill out the form</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Rule query statement (this is where you write a SQL statement that queries every message from raspberry pi) you may have a sql statement like the following:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Rule to write all data in DynamoDB</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">SELECT room, temperature, timestamp() AS timestamp, topic() AS topic FROM &#8216;IoTTemperatureProject&#8217; WHERE room = &#8216;main&#8217; OR room = &#8216;basement&#8217; OR room =&#8217;upstairs&#8217;</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">I then added a trigger to send the message to DynamoDB database.</span></li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Another rule to turn on or off the fan:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">SELECT room, temperature, timestamp() AS timestamp, topic() AS topic FROM &#8216;IoTTemperatureProject&#8217; WHERE room = &#8216;upstairs&#8217;</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">I then added a trigger to call lambda function, that lambda will check whether to send to turn fan on or off slack message to slackbot running at home.</span></li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Rule when a temperature is a specific level “upstairs” and surpass a certain temperature</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">SELECT room, temperature, timestamp() AS timestamp, topic() AS topic FROM &#8216;IoTTemperatureProject&#8217; WHERE room = &#8216;upstairs&#8217; AND temperature &gt; 70</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">I then added a trigger to send a SNS message to my cell phone</span></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">For debugging you can always do the following:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">IoT Core &gt; Test &gt; fill out the form with the topic that it will be receiving from raspberry pi and observe whether it is receiving the messages or not and whether the message is in the format that you intended.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setup DynamoDB:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">DynamoDB &gt; Create Table &gt; fill out form &gt; primary key will be a combination of level and timestamp as a sort key</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Also create an IAM role that is able to write to this database, the AWS MQTT client message will need this policy in order to write to this database.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setup Lambda:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Lambda &gt; Create Function &gt; fill out form &gt; import a restful api module</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">IAM policy can be just a basic lambda execution</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create methods to check whether you need to send a slack message to turn on or off the fan</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Post the http request to the right slackbot (on or off message)</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setup SNS:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">SNS &gt; Topics &gt; create a new topic &gt; fill out form </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Now subscribe to the topic:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">In SNS go to “Subscriptions” &gt; create subscription &gt; add ARN from previous topic</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Protocol: SMS</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Endpoint: &lt;Your cell phone number&gt;</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create subscription</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Then you will get a text to confirm the subscription</span></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setting up S3 bucket to host timeframe temperature data for all 3 levels, create an api gateway that once triggered it will call a lambda function which in turn will query the DynamoDB and send the temperatures back for a given timeframe, how to:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setting up S3 and enabling static website host:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">S3 &gt; Create bucket &gt; fill out the form</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Once bucket is created go to “Properties”</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Static website hosting</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Fill out form and enable website hosting</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">The go to “Permissions” &gt; Bucket Policy &gt; the add a policy similar to this:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">{</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">    &#8220;Version&#8221;: &#8220;2008-10-17&#8221;,</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">    &#8220;Statement&#8221;: [</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">        {</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            &#8220;Sid&#8221;: &#8220;AllowPublicRead&#8221;,</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            &#8220;Effect&#8221;: &#8220;Allow&#8221;,</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            &#8220;Principal&#8221;: {</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">                &#8220;AWS&#8221;: &#8220;*&#8221;</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            },</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            &#8220;Action&#8221;: &#8220;s3:GetObject&#8221;,</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">            &#8220;Resource&#8221;: &#8220;arn:aws:s3:::&lt;your-bucket-name&gt;/*&#8221;</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">        }</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">    ]</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">}</span></li>
<li style="font-weight: 400;"></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create a html file (index.html) and on page load request data by hitting an AWS API Gateway endpoint.</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setting up API Gateway:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">API Gateway &gt; Create API &gt; fill out the form as New API</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Once API is created then &gt; Actions &gt; Create method &gt; GET</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Make sure to enable CORS</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Add the ARN from the lambda that it will be calling</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Actions &gt; Deploy API</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setting up Lambda that will be called from API Gateway:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Go to AWS web Console</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Lambda &gt; Create Function &gt; fill out form </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create an IAM policy that will be able to query (Read) the DynamoDB</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use AWS DynamoDB modules to query it and respond with the desired data for a specific timeframe</span></li>
</ol>
</li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Setting a slack channel and slackbot:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Sign up for a slack account at </span><a href="https://slack.com"><span style="font-weight: 400;">https://slack.com</span></a><span style="font-weight: 400;">:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create a channel</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create an app</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create a slack bot</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Keep track of the bot token</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Enable webhook incoming requests to post to a specific channel you have created earlier.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Keep track of the webhook URL</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Allow a bot to post to a specific channel</span></li>
</ol>
</li>
<li style="font-weight: 400;"><span style="font-weight: 400;">How to create a bot script:</span>
<ol>
<li style="font-weight: 400;"><span style="font-weight: 400;">Import json, requests, slackclient use pip install on 3rd party libraries</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Use your bot token to use with slackclient library</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Get slack user id from bot name</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Connect to slack</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Create an infinite loop that looks for messages</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Filter out the message you want the bot to act on</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If it finds a message that contains string “fan on” then send an http request to Wemo smart plug to turn the plug on and respond to slack channel.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If it finds a message that contains string “fan off” then send an http request to Wemo smart plug to turn the plug off and respond to slack channel.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">If it finds a message that contains string “basement” or “main” or “upstairs” query via http the ESP8266 that is serving as a RESTful API to get the data and respond to slack channel accordingly.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">Add retry logic on the http requests, just in case a request fails for some reason, also add timeout so that a request doesn’t wait for too long.</span></li>
</ol>
</li>
</ol>
</li>
</ol>
<p><a href="./images/projectUpstairsDHt22Sensors.jpeg"><img loading="lazy" class="alignnone size-full wp-image-165" src="./images/projectUpstairsDHt22Sensors.jpeg" alt="" width="4032" height="3024" /></a></p>
<p><span style="font-weight: 400;">Upstairs level &#8211; ESP8266 serving as a Restful API and the other serving as upstairs temperature sensor.</span></p>
<p><a href="./images/projectMainLevelDHt22Sensors.jpeg"><img loading="lazy" class="alignnone size-full wp-image-167" src="./images/projectMainLevelDHt22Sensors.jpeg" alt="" width="4032" height="3024" /></a></p>
<p><span style="font-weight: 400;">Main Level &#8211; ESP8266 Temperature sensor</span></p>
<p><a href="./images/projectBasementDHt11Sensors.jpeg"><img loading="lazy" class="alignnone size-full wp-image-168" src="./images/projectBasementDHt11Sensors.jpeg" alt="" width="4032" height="3024" /></a></p>
<p><span style="font-weight: 400;">Basement level &#8211; ESP8266 Temperature sensor</span></p>
<p><a href="./images/projectFan.jpeg"><img loading="lazy" class="alignnone size-full wp-image-166" src="./images/projectFan.jpeg" alt="" width="3024" height="4032" /></a></p>
<p><span style="font-weight: 400;">Upstairs fan</span></p>
<p><a href="./images/projectSlackChannelSlackBotCommandsResponses.png"><img loading="lazy" class="alignnone size-full wp-image-164" src="./images/projectSlackChannelSlackBotCommandsResponses.png" alt="" width="772" height="888" /></a></p>
<p><span style="font-weight: 400;">Slack channel showing slackbot commands and responses</span></p>
<p><a href="./images/projectSlackBotPythonScriptMessagesArrivingAndSendingCommands.png"><img loading="lazy" class="alignnone size-full wp-image-162" src="./images/projectSlackBotPythonScriptMessagesArrivingAndSendingCommands.png" alt="" width="551" height="969" /></a></p>
<p><span style="font-weight: 400;">Slackbot python script messages arriving and sending commands</span></p>
<p><a href="./images/projectSnsAwsTextMessagesTempAbove70.png"><img loading="lazy" class="alignnone size-full wp-image-178" src="./images/projectSnsAwsTextMessagesTempAbove70.png" alt="" width="2436" height="1125" /></a></p>
<p><span style="font-weight: 400;">SNS text message when upstairs temperature is above 70</span></p>
<p><span style="font-weight: 400;">Diagrams were facilitated by open source programs such as: Google drive plugin draw.io Diagrams.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">Estimate the total time you spent on this project and report. </span></p>
<ul>
<li style="font-weight: 400;"><span style="font-weight: 400;">2 hour building the circuit and cluster of devices to work well.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">8 hours coding all esp8266 sensors, restful server and fixing bugs </span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">10 hours on AWS integration including DynamoDB, SNS, Lambda, AWS Iot Core, API Gateway, IAM policies</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">4 hours working on the lab report using tools such as Google draw.io Diagrams  and fritzing.</span></li>
<li style="font-weight: 400;"><span style="font-weight: 400;">1 hours publishing a website.</span></li>
</ul>
<p>&nbsp;</p>
<h1><span style="font-weight: 400;">Certification of Work</span></h1>
<p><span style="font-weight: 400;">I certify that the solution presented in this lab represents my own work. In the case where I have borrowed code or ideas from another person, I have provided a link to the author’s work in the references, and included a citation in the comments of my code.</span></p>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">&#8212; Lehi Alcantara</span></p>
<h1><span style="font-weight: 400;">Appendix</span></h1>
<h2><span style="font-weight: 400;">Appendix 1: System Diagram</span></h2>
<p><a href="./images/projectSystemDiagram.png"><img loading="lazy" class="alignnone size-full wp-image-170" src="./images/projectSystemDiagram.png" alt="" width="1399" height="779" /></a></p>
<p><span style="font-weight: 400;">IoT Project Sensors Temperature System Diagram</span></p>
<p>&nbsp;</p>
<h2><span style="font-weight: 400;">Appendix 2: Arduino And Lambda And ProjectPibot Code</span></h2>
<p>&nbsp;</p>
<p><span style="font-weight: 400;">(Available at </span><a href="https://github.com/ylehilds/iot-temperature-project"><span style="font-weight: 400;">https://github.com/ylehilds/iot-temperature-project</span></a><span style="font-weight: 400;">)</span></p>
<p>&nbsp;</p>
	</div>
</article>
</body>
</html>
